<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Casa de la Cultura Sanmartineca</title>

    <!-- Versi√≥n del sitio (actual√≠zala en cada release: 1.0.1, 1.0.2, ‚Ä¶) -->
    <meta name="version" content="1.0.0" />

    <!-- Colores de interfaz (tema claro) -->
    <meta name="theme-color" content="#ffffff" />
    <meta name="color-scheme" content="light" />

    <!-- Fuente: Inter (mejor legibilidad) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />

    <!-- Manifest PWA (no registramos SW, solo deja el manifest si quieres iconos) -->
    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- Icono -->
    <link rel="icon" type="image/png" href="/icon-192.png" />
  </head>
  <body>
    <div id="root"></div>

    <!-- App React -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- Limpieza de Service Workers/cach√©s antiguos -->
    <script>
      (async function cleanupOldSW() {
        if (!("serviceWorker" in navigator)) return;
        try {
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const r of regs) { try { await r.unregister(); } catch {} }
          if (typeof caches !== "undefined" && caches.keys) {
            const keys = await caches.keys();
            for (const k of keys) { try { await caches.delete(k); } catch {} }
          }
        } catch {}
      })();
    </script>

    <!-- Auto-chequeo de nueva versi√≥n en el servidor y recarga autom√°tica una sola vez -->
    <script>
      (async () => {
        try {
          // Evita sobrecargar: si quieres, limita a producci√≥n con vercel.app o tu dominio
          const res = await fetch("/index.html", { cache: "no-store" });
          const text = await res.text();
          const remoteVersionMatch = text.match(
            /<meta name="version" content="([^"]+)"/
          );
          const localVersion = document
            .querySelector("meta[name='version']")
            ?.getAttribute("content");

          const remoteVersion = remoteVersionMatch ? remoteVersionMatch[1] : null;

          if (localVersion && remoteVersion && localVersion !== remoteVersion) {
            console.log("üîÑ Nueva versi√≥n detectada:", remoteVersion, "(local:", localVersion, ")");
            location.reload();
          }
        } catch (e) {
          console.warn("No se pudo verificar la versi√≥n m√°s reciente.", e);
        }
      })();
    </script>
    <!-- Importante: ya NO registramos ning√∫n Service Worker -->
  </body>
</html>
